{
	"info": {
		"_postman_id": "2693f2d4-e95e-42cd-b342-fdf93359e70c",
		"name": "DISI MVP",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "MPI interactions",
			"item": [
				{
					"name": "Register random patient",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"let headerValue = pm.response.headers.get(\"location\")",
									"pm.collectionVariables.set(\"extPatientRef\", headerValue);",
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"type": "text",
								"value": "application/fhir+json"
							},
							{
								"key": "Authorization",
								"type": "text",
								"value": "Custom test"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"resourceType\": \"Patient\",\n    \"meta\": {\n        \"profile\": [\n            \"http://openhie.org/fhir/StructureDefinition/hiv-patient\"\n        ]\n    },\n    \"identifier\": [\n        {\n            \"system\": \"https://instantopenhie.org/client{{randomClientId}}\",\n            \"value\": \"{{$guid}}\"\n        }\n    ],\n    \"active\": true,\n    \"name\": [\n        {\n            \"use\": \"official\",\n            \"given\": [\n                \"{{$randomFirstName}}\"\n            ],\n            \"family\": \"{{$randomLastName}}\"\n        }\n    ],\n    \"gender\": \"{{gender}}\",\n    \"birthDate\": \"{{dob}}\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "http://{{openhimHost}}:{{openhimPort}}/client/Patient",
							"protocol": "http",
							"host": [
								"{{openhimHost}}"
							],
							"port": "{{openhimPort}}",
							"path": [
								"client",
								"Patient"
							]
						}
					},
					"response": []
				},
				{
					"name": "Register duplicate patient - facility 1",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"pm.collectionVariables.set(\"localPatientID\", \"1111111111\")"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"type": "text",
								"value": "application/fhir+json"
							},
							{
								"key": "Authorization",
								"type": "text",
								"value": "Custom test"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"resourceType\": \"Patient\",\n    \"meta\": {\n        \"profile\": [\n            \"http://openhie.org/fhir/StructureDefinition/hiv-patient\"\n        ]\n    },\n    \"identifier\": [\n        {\n            \"system\": \"https://instantopenhie.org/client1\",\n            \"value\": \"{{localPatientID}}\"\n        }\n    ],\n    \"active\": true,\n    \"name\": [\n        {\n            \"use\": \"official\",\n            \"given\": [\n                \"Jane\"\n            ],\n            \"family\": \"Smith\"\n        }\n    ],\n    \"gender\": \"female\",\n    \"birthDate\": \"1986-06-04\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "http://{{openhimHost}}:{{openhimPort}}/client/Patient",
							"protocol": "http",
							"host": [
								"{{openhimHost}}"
							],
							"port": "{{openhimPort}}",
							"path": [
								"client",
								"Patient"
							]
						}
					},
					"response": []
				},
				{
					"name": "Register duplicate patient - facility 2",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"pm.collectionVariables.set(\"localPatientID\", \"2222222222\")"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"type": "text",
								"value": "application/fhir+json"
							},
							{
								"key": "Authorization",
								"type": "text",
								"value": "Custom test"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"resourceType\": \"Patient\",\n    \"meta\": {\n        \"profile\": [\n            \"http://openhie.org/fhir/StructureDefinition/hiv-patient\"\n        ]\n    },\n    \"identifier\": [\n        {\n            \"system\": \"https://instantopenhie.org/client2\",\n            \"value\": \"{{localPatientID}}\"\n        }\n    ],\n    \"active\": true,\n    \"name\": [\n        {\n            \"use\": \"official\",\n            \"given\": [\n                \"Jaane\"\n            ],\n            \"family\": \"Smiith\"\n        }\n    ],\n    \"gender\": \"female\",\n    \"birthDate\": \"1986-06-04\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "http://{{openhimHost}}:{{openhimPort}}/client/Patient",
							"protocol": "http",
							"host": [
								"{{openhimHost}}"
							],
							"port": "{{openhimPort}}",
							"path": [
								"client",
								"Patient"
							]
						}
					},
					"response": []
				},
				{
					"name": "Register duplicate patient - facility 3 - (manual link)",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"pm.collectionVariables.set(\"localPatientID\", \"3333333333\")"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"type": "text",
								"value": "application/fhir+json"
							},
							{
								"key": "Authorization",
								"type": "text",
								"value": "Custom test"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"resourceType\": \"Patient\",\n    \"meta\": {\n        \"profile\": [\n            \"http://openhie.org/fhir/StructureDefinition/hiv-patient\"\n        ]\n    },\n    \"identifier\": [\n        {\n            \"system\": \"https://instantopenhie.org/client3\",\n            \"value\": \"{{localPatientID}}\"\n        }\n    ],\n    \"active\": true,\n    \"name\": [\n        {\n            \"use\": \"official\",\n            \"given\": [\n                \"Jan\"\n            ],\n            \"family\": \"Smthxxyz\"\n        }\n    ],\n    \"gender\": \"female\",\n    \"birthDate\": \"1986-06-04\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "http://{{openhimHost}}:{{openhimPort}}/client/Patient",
							"protocol": "http",
							"host": [
								"{{openhimHost}}"
							],
							"port": "{{openhimPort}}",
							"path": [
								"client",
								"Patient"
							]
						},
						"description": "Will create a patient that needs manual action to be matched with other patients from the request above in OpenCR."
					},
					"response": []
				},
				{
					"name": "Get patient local ID from CR",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"let body = pm.response.json()",
									"pm.collectionVariables.set(\"extPatientRef\", `Patient/${body.entry[0].resource.id}`);"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/fhir+json",
								"type": "text"
							},
							{
								"key": "Authorization",
								"value": "Custom test",
								"type": "text"
							}
						],
						"url": {
							"raw": "http://{{openhimHost}}:{{openhimPort}}/client/Patient?identifier={{localPatientID}}",
							"protocol": "http",
							"host": [
								"{{openhimHost}}"
							],
							"port": "{{openhimPort}}",
							"path": [
								"client",
								"Patient"
							],
							"query": [
								{
									"key": "identifier",
									"value": "{{localPatientID}}"
								}
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "Submit CBS events bundle",
			"item": [
				{
					"name": "All events, random patient",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"type": "text",
								"value": "application/fhir+json"
							},
							{
								"key": "Authorization",
								"type": "text",
								"value": "Custom test"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"resourceType\": \"Bundle\",\n  \"type\": \"transaction\",\n  \"entry\": [\n    {\n      \"resource\": {\n        \"resourceType\": \"Composition\",\n        \"subject\": {\n          \"reference\": \"urn:uuid:patient\"\n        }\n      },\n      \"request\": {\n        \"method\": \"POST\"\n      }\n    },\n    {\n      \"fullUrl\": \"urn:uuid:patient\",\n      \"resource\": {\n        \"resourceType\": \"Patient\",\n        \"meta\": {\n          \"profile\": [\n            \"http://openhie.org/fhir/StructureDefinition/hiv-patient\"\n          ]\n        },\n        \"identifier\": [\n          {\n            \"system\": \"https://instantopenhie.org/client{{randomClientId}}\",\n            \"value\": \"{{$guid}}\"\n          }\n        ],\n        \"active\": true,\n        \"name\": [\n          {\n            \"use\": \"official\",\n            \"given\": [\n              \"{{$randomFirstName}}\"\n            ],\n            \"family\": \"{{$randomLastName}}\"\n          }\n        ],\n        \"gender\": \"{{gender}}\",\n        \"birthDate\": \"{{dob}}\"\n      },\n      \"request\": {\n        \"method\": \"POST\"\n      }\n    },\n    {\n      \"fullUrl\": \"\",\n      \"resource\": {\n        \"resourceType\": \"Condition\",\n        \"meta\": {\n          \"profile\": [\n            \"http://openhie.org/fhir/StructureDefinition/hiv-condition\"\n          ]\n        },\n        \"clinicalStatus\": {\n          \"coding\": [\n            {\n              \"code\": \"active\"\n            }\n          ]\n        },\n        \"verificationStatus\": {\n          \"coding\": [\n            {\n              \"code\": \"confirmed\"\n            }\n          ]\n        },\n        \"code\": {\n          \"coding\": [\n            {\n              \"code\": \"86406008\",\n              \"system\": \"http://snomed.info/sct\"\n            }\n          ]\n        },\n        \"subject\": {\n          \"reference\": \"urn:uuid:patient\"\n        }\n      },\n      \"request\": {\n        \"method\": \"POST\"\n      }\n    },\n    {\n      \"fullUrl\": \"\",\n      \"resource\": {\n        \"resourceType\": \"MedicationStatement\",\n        \"meta\": {\n          \"profile\": [\n            \"http://openhie.org/fhir/StructureDefinition/arv-therapy-summary\"\n          ]\n        },\n        \"status\": \"active\",\n        \"medicationCodeableConcept\": {\n          \"coding\": [\n            {\n              \"code\": \"ART\",\n              \"system\": \"http://test.org/medication-type\",\n              \"display\": \"Antiretrovirals\"\n            }\n          ]\n        },\n        \"subject\": {\n          \"reference\": \"urn:uuid:patient\"\n        }\n      },\n      \"request\": {\n        \"method\": \"POST\"\n      }\n    },\n    {\n      \"fullUrl\": \"\",\n      \"resource\": {\n        \"resourceType\": \"Observation\",\n        \"meta\": {\n          \"profile\": [\n            \"http://openhie.org/fhir/StructureDefinition/hiv-viral-load\"\n          ]\n        },\n        \"status\": \"final\",\n        \"code\": {\n          \"coding\": [\n            {\n              \"code\": \"VL-RESULT\",\n              \"system\": \"http://test.org/obs\",\n              \"display\": \"Viral load result\"\n            }\n          ]\n        },\n        \"subject\": {\n          \"reference\": \"urn:uuid:patient\"\n        },\n        \"valueCodeableConcept\": {\n          \"coding\": [\n            {\n              \"code\": \"{{vlCode}}\",\n              \"system\": \"http://test.org/obs/vl-result\",\n              \"display\": \"{{vlDisplay}}\"\n            }\n          ]\n        }\n      },\n      \"request\": {\n        \"method\": \"POST\"\n      }\n    }\n  ]\n}\n",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "http://{{openhimHost}}:{{openhimPort}}/fhir",
							"protocol": "http",
							"host": [
								"{{openhimHost}}"
							],
							"port": "{{openhimPort}}",
							"path": [
								"fhir"
							]
						}
					},
					"response": []
				},
				{
					"name": "All events, duplicate patient - facility 1",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"type": "text",
								"value": "application/fhir+json"
							},
							{
								"key": "Authorization",
								"type": "text",
								"value": "Custom test"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"resourceType\": \"Bundle\",\n  \"type\": \"transaction\",\n  \"entry\": [\n    {\n      \"resource\": {\n        \"resourceType\": \"Composition\",\n        \"subject\": {\n          \"reference\": \"urn:uuid:patient\"\n        }\n      },\n      \"request\": {\n        \"method\": \"POST\"\n      }\n    },\n    {\n      \"fullUrl\": \"urn:uuid:patient\",\n      \"resource\": {\n        \"resourceType\": \"Patient\",\n        \"meta\": {\n          \"profile\": [\n            \"http://openhie.org/fhir/StructureDefinition/hiv-patient\"\n          ]\n        },\n        \"identifier\": [\n          {\n            \"system\": \"https://instantopenhie.org/client1\",\n            \"value\": \"121212\"\n          }\n        ],\n        \"active\": true,\n        \"name\": [\n          {\n            \"use\": \"official\",\n            \"given\": [\n              \"John\"\n            ],\n            \"family\": \"Snow\"\n          }\n        ],\n        \"gender\": \"male\",\n        \"birthDate\": \"1990-01-02\"\n      },\n      \"request\": {\n        \"method\": \"POST\"\n      }\n    },\n    {\n      \"fullUrl\": \"\",\n      \"resource\": {\n        \"resourceType\": \"Condition\",\n        \"meta\": {\n          \"profile\": [\n            \"http://openhie.org/fhir/StructureDefinition/hiv-condition\"\n          ]\n        },\n        \"clinicalStatus\": {\n          \"coding\": [\n            {\n              \"code\": \"active\"\n            }\n          ]\n        },\n        \"verificationStatus\": {\n          \"coding\": [\n            {\n              \"code\": \"confirmed\"\n            }\n          ]\n        },\n        \"code\": {\n          \"coding\": [\n            {\n              \"code\": \"86406008\",\n              \"system\": \"http://snomed.info/sct\"\n            }\n          ]\n        },\n        \"subject\": {\n          \"reference\": \"urn:uuid:patient\"\n        }\n      },\n      \"request\": {\n        \"method\": \"POST\"\n      }\n    },\n    {\n      \"fullUrl\": \"\",\n      \"resource\": {\n        \"resourceType\": \"MedicationStatement\",\n        \"meta\": {\n          \"profile\": [\n            \"http://openhie.org/fhir/StructureDefinition/arv-therapy-summary\"\n          ]\n        },\n        \"status\": \"active\",\n        \"medicationCodeableConcept\": {\n          \"coding\": [\n            {\n              \"code\": \"ART\",\n              \"system\": \"http://test.org/medication-type\",\n              \"display\": \"Antiretrovirals\"\n            }\n          ]\n        },\n        \"subject\": {\n          \"reference\": \"urn:uuid:patient\"\n        }\n      },\n      \"request\": {\n        \"method\": \"POST\"\n      }\n    },\n    {\n      \"fullUrl\": \"\",\n      \"resource\": {\n        \"resourceType\": \"Observation\",\n        \"meta\": {\n          \"profile\": [\n            \"http://openhie.org/fhir/StructureDefinition/hiv-viral-load\"\n          ]\n        },\n        \"status\": \"final\",\n        \"code\": {\n          \"coding\": [\n            {\n              \"code\": \"VL-RESULT\",\n              \"system\": \"http://test.org/obs\",\n              \"display\": \"Viral load result\"\n            }\n          ]\n        },\n        \"subject\": {\n          \"reference\": \"urn:uuid:patient\"\n        },\n        \"valueCodeableConcept\": {\n          \"coding\": [\n            {\n              \"code\": \"{{vlCode}}\",\n              \"system\": \"http://test.org/obs/vl-result\",\n              \"display\": \"{{vlDisplay}}\"\n            }\n          ]\n        }\n      },\n      \"request\": {\n        \"method\": \"POST\"\n      }\n    }\n  ]\n}\n",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "http://{{openhimHost}}:{{openhimPort}}/fhir",
							"protocol": "http",
							"host": [
								"{{openhimHost}}"
							],
							"port": "{{openhimPort}}",
							"path": [
								"fhir"
							]
						}
					},
					"response": []
				},
				{
					"name": "All events, duplicate patient - facility 2",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"type": "text",
								"value": "application/fhir+json"
							},
							{
								"key": "Authorization",
								"type": "text",
								"value": "Custom test"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"resourceType\": \"Bundle\",\n  \"type\": \"transaction\",\n  \"entry\": [\n    {\n      \"resource\": {\n        \"resourceType\": \"Composition\",\n        \"subject\": {\n          \"reference\": \"urn:uuid:patient\"\n        }\n      },\n      \"request\": {\n        \"method\": \"POST\"\n      }\n    },\n    {\n      \"fullUrl\": \"urn:uuid:patient\",\n      \"resource\": {\n        \"resourceType\": \"Patient\",\n        \"meta\": {\n          \"profile\": [\n            \"http://openhie.org/fhir/StructureDefinition/hiv-patient\"\n          ]\n        },\n        \"identifier\": [\n          {\n            \"system\": \"https://instantopenhie.org/client2\",\n            \"value\": \"131313\"\n          }\n        ],\n        \"active\": true,\n        \"name\": [\n          {\n            \"use\": \"official\",\n            \"given\": [\n              \"Johnn\"\n            ],\n            \"family\": \"Snoww\"\n          }\n        ],\n        \"gender\": \"male\",\n        \"birthDate\": \"1990-01-02\"\n      },\n      \"request\": {\n        \"method\": \"POST\"\n      }\n    },\n    {\n      \"fullUrl\": \"\",\n      \"resource\": {\n        \"resourceType\": \"Condition\",\n        \"meta\": {\n          \"profile\": [\n            \"http://openhie.org/fhir/StructureDefinition/hiv-condition\"\n          ]\n        },\n        \"clinicalStatus\": {\n          \"coding\": [\n            {\n              \"code\": \"active\"\n            }\n          ]\n        },\n        \"verificationStatus\": {\n          \"coding\": [\n            {\n              \"code\": \"confirmed\"\n            }\n          ]\n        },\n        \"code\": {\n          \"coding\": [\n            {\n              \"code\": \"86406008\",\n              \"system\": \"http://snomed.info/sct\"\n            }\n          ]\n        },\n        \"subject\": {\n          \"reference\": \"urn:uuid:patient\"\n        }\n      },\n      \"request\": {\n        \"method\": \"POST\"\n      }\n    },\n    {\n      \"fullUrl\": \"\",\n      \"resource\": {\n        \"resourceType\": \"MedicationStatement\",\n        \"meta\": {\n          \"profile\": [\n            \"http://openhie.org/fhir/StructureDefinition/arv-therapy-summary\"\n          ]\n        },\n        \"status\": \"active\",\n        \"medicationCodeableConcept\": {\n          \"coding\": [\n            {\n              \"code\": \"ART\",\n              \"system\": \"http://test.org/medication-type\",\n              \"display\": \"Antiretrovirals\"\n            }\n          ]\n        },\n        \"subject\": {\n          \"reference\": \"urn:uuid:patient\"\n        }\n      },\n      \"request\": {\n        \"method\": \"POST\"\n      }\n    },\n    {\n      \"fullUrl\": \"\",\n      \"resource\": {\n        \"resourceType\": \"Observation\",\n        \"meta\": {\n          \"profile\": [\n            \"http://openhie.org/fhir/StructureDefinition/hiv-viral-load\"\n          ]\n        },\n        \"status\": \"final\",\n        \"code\": {\n          \"coding\": [\n            {\n              \"code\": \"VL-RESULT\",\n              \"system\": \"http://test.org/obs\",\n              \"display\": \"Viral load result\"\n            }\n          ]\n        },\n        \"subject\": {\n          \"reference\": \"urn:uuid:patient\"\n        },\n        \"valueCodeableConcept\": {\n          \"coding\": [\n            {\n              \"code\": \"{{vlCode}}\",\n              \"system\": \"http://test.org/obs/vl-result\",\n              \"display\": \"{{vlDisplay}}\"\n            }\n          ]\n        }\n      },\n      \"request\": {\n        \"method\": \"POST\"\n      }\n    }\n  ]\n}\n",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "http://{{openhimHost}}:{{openhimPort}}/fhir",
							"protocol": "http",
							"host": [
								"{{openhimHost}}"
							],
							"port": "{{openhimPort}}",
							"path": [
								"fhir"
							]
						}
					},
					"response": []
				},
				{
					"name": "All events, duplicate patient - facility 3 - (manual link)",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"type": "text",
								"value": "application/fhir+json"
							},
							{
								"key": "Authorization",
								"type": "text",
								"value": "Custom test"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"resourceType\": \"Bundle\",\n  \"type\": \"transaction\",\n  \"entry\": [\n    {\n      \"resource\": {\n        \"resourceType\": \"Composition\",\n        \"subject\": {\n          \"reference\": \"urn:uuid:patient\"\n        }\n      },\n      \"request\": {\n        \"method\": \"POST\"\n      }\n    },\n    {\n      \"fullUrl\": \"urn:uuid:patient\",\n      \"resource\": {\n        \"resourceType\": \"Patient\",\n        \"meta\": {\n          \"profile\": [\n            \"http://openhie.org/fhir/StructureDefinition/hiv-patient\"\n          ]\n        },\n        \"identifier\": [\n          {\n            \"system\": \"https://instantopenhie.org/client3\",\n            \"value\": \"141414\"\n          }\n        ],\n        \"active\": true,\n        \"name\": [\n          {\n            \"use\": \"official\",\n            \"given\": [\n              \"John\"\n            ],\n            \"family\": \"Sssnnowww\"\n          }\n        ],\n        \"gender\": \"male\",\n        \"birthDate\": \"1990-01-02\"\n      },\n      \"request\": {\n        \"method\": \"POST\"\n      }\n    },\n    {\n      \"fullUrl\": \"\",\n      \"resource\": {\n        \"resourceType\": \"Condition\",\n        \"meta\": {\n          \"profile\": [\n            \"http://openhie.org/fhir/StructureDefinition/hiv-condition\"\n          ]\n        },\n        \"clinicalStatus\": {\n          \"coding\": [\n            {\n              \"code\": \"active\"\n            }\n          ]\n        },\n        \"verificationStatus\": {\n          \"coding\": [\n            {\n              \"code\": \"confirmed\"\n            }\n          ]\n        },\n        \"code\": {\n          \"coding\": [\n            {\n              \"code\": \"86406008\",\n              \"system\": \"http://snomed.info/sct\"\n            }\n          ]\n        },\n        \"subject\": {\n          \"reference\": \"urn:uuid:patient\"\n        }\n      },\n      \"request\": {\n        \"method\": \"POST\"\n      }\n    },\n    {\n      \"fullUrl\": \"\",\n      \"resource\": {\n        \"resourceType\": \"MedicationStatement\",\n        \"meta\": {\n          \"profile\": [\n            \"http://openhie.org/fhir/StructureDefinition/arv-therapy-summary\"\n          ]\n        },\n        \"status\": \"active\",\n        \"medicationCodeableConcept\": {\n          \"coding\": [\n            {\n              \"code\": \"ART\",\n              \"system\": \"http://test.org/medication-type\",\n              \"display\": \"Antiretrovirals\"\n            }\n          ]\n        },\n        \"subject\": {\n          \"reference\": \"urn:uuid:patient\"\n        }\n      },\n      \"request\": {\n        \"method\": \"POST\"\n      }\n    },\n    {\n      \"fullUrl\": \"\",\n      \"resource\": {\n        \"resourceType\": \"Observation\",\n        \"meta\": {\n          \"profile\": [\n            \"http://openhie.org/fhir/StructureDefinition/hiv-viral-load\"\n          ]\n        },\n        \"status\": \"final\",\n        \"code\": {\n          \"coding\": [\n            {\n              \"code\": \"VL-RESULT\",\n              \"system\": \"http://test.org/obs\",\n              \"display\": \"Viral load result\"\n            }\n          ]\n        },\n        \"subject\": {\n          \"reference\": \"urn:uuid:patient\"\n        },\n        \"valueCodeableConcept\": {\n          \"coding\": [\n            {\n              \"code\": \"{{vlCode}}\",\n              \"system\": \"http://test.org/obs/vl-result\",\n              \"display\": \"{{vlDisplay}}\"\n            }\n          ]\n        }\n      },\n      \"request\": {\n        \"method\": \"POST\"\n      }\n    }\n  ]\n}\n",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "http://{{openhimHost}}:{{openhimPort}}/fhir",
							"protocol": "http",
							"host": [
								"{{openhimHost}}"
							],
							"port": "{{openhimPort}}",
							"path": [
								"fhir"
							]
						},
						"description": "Will create a patient that needs manual action to be matched with other patients from the request above in OpenCR."
					},
					"response": []
				},
				{
					"name": "All events, external patient reference",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"type": "text",
								"value": "application/fhir+json"
							},
							{
								"key": "Authorization",
								"type": "text",
								"value": "Custom test"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"resourceType\": \"Bundle\",\n  \"type\": \"transaction\",\n  \"entry\": [\n    {\n      \"resource\": {\n        \"resourceType\": \"Composition\",\n        \"patient\": {\n          \"reference\": \"{{extPatientRef}}\"\n        }\n      },\n      \"request\": {\n        \"method\": \"POST\"\n      }\n    },\n    {\n      \"fullUrl\": \"\",\n      \"resource\": {\n        \"resourceType\": \"Condition\",\n        \"meta\": {\n          \"profile\": [\n            \"http://openhie.org/fhir/StructureDefinition/hiv-condition\"\n          ]\n        },\n        \"clinicalStatus\": {\n          \"coding\": [\n            {\n              \"code\": \"active\"\n            }\n          ]\n        },\n        \"verificationStatus\": {\n          \"coding\": [\n            {\n              \"code\": \"confirmed\"\n            }\n          ]\n        },\n        \"code\": {\n          \"coding\": [\n            {\n              \"code\": \"86406008\",\n              \"system\": \"http://snomed.info/sct\"\n            }\n          ]\n        },\n        \"subject\": {\n          \"reference\": \"{{extPatientRef}}\"\n        }\n      },\n      \"request\": {\n        \"method\": \"POST\"\n      }\n    },\n    {\n      \"fullUrl\": \"\",\n      \"resource\": {\n        \"resourceType\": \"MedicationStatement\",\n        \"meta\": {\n          \"profile\": [\n            \"http://openhie.org/fhir/StructureDefinition/arv-therapy-summary\"\n          ]\n        },\n        \"status\": \"active\",\n        \"medicationCodeableConcept\": {\n          \"coding\": [\n            {\n              \"code\": \"ART\",\n              \"system\": \"http://test.org/medication-type\",\n              \"display\": \"Antiretrovirals\"\n            }\n          ]\n        },\n        \"subject\": {\n          \"reference\": \"{{extPatientRef}}\"\n        }\n      },\n      \"request\": {\n        \"method\": \"POST\"\n      }\n    },\n    {\n      \"fullUrl\": \"\",\n      \"resource\": {\n        \"resourceType\": \"Observation\",\n        \"meta\": {\n          \"profile\": [\n            \"http://openhie.org/fhir/StructureDefinition/hiv-viral-load\"\n          ]\n        },\n        \"status\": \"final\",\n        \"code\": {\n          \"coding\": [\n            {\n              \"code\": \"VL-RESULT\",\n              \"system\": \"http://test.org/obs\",\n              \"display\": \"Viral load result\"\n            }\n          ]\n        },\n        \"subject\": {\n          \"reference\": \"{{extPatientRef}}\"\n        },\n        \"valueCodeableConcept\": {\n          \"coding\": [\n            {\n              \"code\": \"{{vlCode}}\",\n              \"system\": \"http://test.org/obs/vl-result\",\n              \"display\": \"{{vlDisplay}}\"\n            }\n          ]\n        }\n      },\n      \"request\": {\n        \"method\": \"POST\"\n      }\n    }\n  ]\n}\n",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "http://{{openhimHost}}:{{openhimPort}}/fhir",
							"protocol": "http",
							"host": [
								"{{openhimHost}}"
							],
							"port": "{{openhimPort}}",
							"path": [
								"fhir"
							]
						},
						"description": "Before running this one you need to run:\n* Register duplicate patient - facility x\n* Get patient local ID from CR"
					},
					"response": []
				},
				{
					"name": "All events, invalid external patient reference",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"type": "text",
								"value": "application/fhir+json"
							},
							{
								"key": "Authorization",
								"type": "text",
								"value": "Custom test"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"resourceType\": \"Bundle\",\n  \"type\": \"transaction\",\n  \"entry\": [\n    {\n      \"resource\": {\n        \"resourceType\": \"Composition\",\n        \"patient\": {\n          \"reference\": \"Patient/555\"\n        }\n      },\n      \"request\": {\n        \"method\": \"POST\"\n      }\n    },\n    {\n      \"fullUrl\": \"\",\n      \"resource\": {\n        \"resourceType\": \"Condition\",\n        \"meta\": {\n          \"profile\": [\n            \"http://openhie.org/fhir/StructureDefinition/hiv-condition\"\n          ]\n        },\n        \"clinicalStatus\": {\n          \"coding\": [\n            {\n              \"code\": \"active\"\n            }\n          ]\n        },\n        \"verificationStatus\": {\n          \"coding\": [\n            {\n              \"code\": \"confirmed\"\n            }\n          ]\n        },\n        \"code\": {\n          \"coding\": [\n            {\n              \"code\": \"86406008\",\n              \"system\": \"http://snomed.info/sct\"\n            }\n          ]\n        },\n        \"subject\": {\n          \"reference\": \"Patient/555\"\n        }\n      },\n      \"request\": {\n        \"method\": \"POST\"\n      }\n    },\n    {\n      \"fullUrl\": \"\",\n      \"resource\": {\n        \"resourceType\": \"MedicationStatement\",\n        \"meta\": {\n          \"profile\": [\n            \"http://openhie.org/fhir/StructureDefinition/arv-therapy-summary\"\n          ]\n        },\n        \"status\": \"active\",\n        \"medicationCodeableConcept\": {\n          \"coding\": [\n            {\n              \"code\": \"ART\",\n              \"system\": \"http://test.org/medication-type\",\n              \"display\": \"Antiretrovirals\"\n            }\n          ]\n        },\n        \"subject\": {\n          \"reference\": \"Patient/555\"\n        }\n      },\n      \"request\": {\n        \"method\": \"POST\"\n      }\n    },\n    {\n      \"fullUrl\": \"\",\n      \"resource\": {\n        \"resourceType\": \"Observation\",\n        \"meta\": {\n          \"profile\": [\n            \"http://openhie.org/fhir/StructureDefinition/hiv-viral-load\"\n          ]\n        },\n        \"status\": \"final\",\n        \"code\": {\n          \"coding\": [\n            {\n              \"code\": \"VL-RESULT\",\n              \"system\": \"http://test.org/obs\",\n              \"display\": \"Viral load result\"\n            }\n          ]\n        },\n        \"subject\": {\n          \"reference\": \"Patient/555\"\n        },\n        \"valueCodeableConcept\": {\n          \"coding\": [\n            {\n              \"code\": \"{{vlCode}}\",\n              \"system\": \"http://test.org/obs/vl-result\",\n              \"display\": \"{{vlDisplay}}\"\n            }\n          ]\n        }\n      },\n      \"request\": {\n        \"method\": \"POST\"\n      }\n    }\n  ]\n}\n",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "http://{{openhimHost}}:{{openhimPort}}/fhir",
							"protocol": "http",
							"host": [
								"{{openhimHost}}"
							],
							"port": "{{openhimPort}}",
							"path": [
								"fhir"
							]
						}
					},
					"response": []
				}
			]
		}
	],
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"type": "text/javascript",
				"exec": [
					"function getRandomInt(min, max) {",
					"    min = Math.ceil(min);",
					"    max = Math.floor(max);",
					"    return Math.floor(Math.random() * (max - min + 1)) + min;",
					"}",
					"",
					"const moment = require('moment');",
					"pm.variables.set('dob', moment().subtract((Math.random() * 50) + 18, 'years').format('YYYY-MM-DD'));",
					"",
					"const gender = ['male', 'female']",
					"pm.variables.set('gender', gender[getRandomInt(0, 1)])",
					"",
					"const vl = [['<200', 'less than 200 - undetectable'], ['200-1000', '200 - 1000 - detectable'], ['>1000', 'greather than 1000 - detectable']]",
					"const vlIndex = getRandomInt(0, 2)",
					"pm.variables.set('vlCode', vl[vlIndex][0])",
					"pm.variables.set('vlDisplay', vl[vlIndex][1])",
					"",
					"pm.variables.set('randomClientId', getRandomInt(1,3))",
					""
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"type": "text/javascript",
				"exec": [
					""
				]
			}
		}
	],
	"variable": [
		{
			"key": "extPatientRef",
			"value": "Patient/123"
		},
		{
			"key": "localPatientID",
			"value": ""
		},
		{
			"key": "openhimHost",
			"value": "localhost"
		},
		{
			"key": "openhimPort",
			"value": "5001"
		}
	]
}