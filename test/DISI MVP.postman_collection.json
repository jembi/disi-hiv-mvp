{
	"info": {
		"_postman_id": "2693f2d4-e95e-42cd-b342-fdf93359e70c",
		"name": "DISI MVP",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "MPI interactions",
			"item": [
				{
					"name": "Register random patient",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"let headerValue = pm.response.headers.get(\"location\")",
									"pm.collectionVariables.set(\"extPatientRef\", headerValue);",
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"type": "text",
								"value": "application/fhir+json"
							},
							{
								"key": "Authorization",
								"type": "text",
								"value": "Custom test"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"resourceType\": \"Patient\",\n    \"meta\": {\n        \"profile\": [\n            \"http://openhie.org/fhir/StructureDefinition/hiv-patient\"\n        ]\n    },\n    \"identifier\": [\n        {\n            \"system\": \"http://test.org/identifier/test-poc\",\n            \"value\": \"{{$guid}}\"\n        },\n        {\n            \"system\": \"https://instantopenhie.org/client{{randomClientId}}\",\n            \"value\": \"{{$guid}}\"\n        }\n    ],\n    \"active\": true,\n    \"name\": [\n        {\n            \"use\": \"official\",\n            \"given\": [\n                \"{{$randomFirstName}}\"\n            ],\n            \"family\": \"{{$randomLastName}}\"\n        }\n    ],\n    \"gender\": \"{{gender}}\",\n    \"birthDate\": \"{{dob}}\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "http://localhost:5001/client/Patient",
							"protocol": "http",
							"host": [
								"localhost"
							],
							"port": "5001",
							"path": [
								"client",
								"Patient"
							]
						}
					},
					"response": []
				},
				{
					"name": "Register duplicate patient - client 1",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"let headerValue = pm.response.headers.get(\"location\")",
									"pm.collectionVariables.set(\"extPatientRef\", headerValue);",
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"type": "text",
								"value": "application/fhir+json"
							},
							{
								"key": "Authorization",
								"type": "text",
								"value": "Custom test"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"resourceType\": \"Patient\",\n    \"meta\": {\n        \"profile\": [\n            \"http://openhie.org/fhir/StructureDefinition/hiv-patient\"\n        ]\n    },\n    \"identifier\": [\n        {\n            \"system\": \"http://test.org/identifier/test-poc\",\n            \"value\": \"1234567890\"\n        },\n        {\n            \"system\": \"https://instantopenhie.org/client1\",\n            \"value\": \"0987654321\"\n        }\n    ],\n    \"active\": true,\n    \"name\": [\n        {\n            \"use\": \"official\",\n            \"given\": [\n                \"Jane\"\n            ],\n            \"family\": \"Smith\"\n        }\n    ],\n    \"gender\": \"female\",\n    \"birthDate\": \"1986-06-04\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "http://localhost:5001/client/Patient",
							"protocol": "http",
							"host": [
								"localhost"
							],
							"port": "5001",
							"path": [
								"client",
								"Patient"
							]
						}
					},
					"response": []
				},
				{
					"name": "Register duplicate patient - client 2",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"let headerValue = pm.response.headers.get(\"location\")",
									"pm.collectionVariables.set(\"extPatientRef\", headerValue);",
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"type": "text",
								"value": "application/fhir+json"
							},
							{
								"key": "Authorization",
								"type": "text",
								"value": "Custom test"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"resourceType\": \"Patient\",\n    \"meta\": {\n        \"profile\": [\n            \"http://openhie.org/fhir/StructureDefinition/hiv-patient\"\n        ]\n    },\n    \"identifier\": [\n        {\n            \"system\": \"http://test.org/identifier/test-poc\",\n            \"value\": \"1234567890\"\n        },\n        {\n            \"system\": \"https://instantopenhie.org/client3\",\n            \"value\": \"1111111111\"\n        }\n    ],\n    \"active\": true,\n    \"name\": [\n        {\n            \"use\": \"official\",\n            \"given\": [\n                \"Jaane\"\n            ],\n            \"family\": \"Smiith\"\n        }\n    ],\n    \"gender\": \"female\",\n    \"birthDate\": \"1986-06-04\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "http://localhost:5001/client/Patient",
							"protocol": "http",
							"host": [
								"localhost"
							],
							"port": "5001",
							"path": [
								"client",
								"Patient"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "Submit CBS events bundle",
			"item": [
				{
					"name": "All events, random patient",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"type": "text",
								"value": "application/fhir+json"
							},
							{
								"key": "Authorization",
								"type": "text",
								"value": "Custom test"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"resourceType\": \"Bundle\",\n  \"type\": \"transaction\",\n  \"entry\": [\n    {\n      \"resource\": {\n        \"resourceType\": \"Composition\",\n        \"patient\": {\n          \"reference\": \"Patient/hiv-patient\"\n        }\n      },\n      \"request\": {\n        \"method\": \"POST\"\n      }\n    },\n    {\n      \"fullUrl\": \"\",\n      \"resource\": {\n        \"resourceType\": \"Patient\",\n        \"meta\": {\n          \"profile\": [\n            \"http://openhie.org/fhir/StructureDefinition/hiv-patient\"\n          ]\n        },\n        \"identifier\": [\n          {\n            \"system\": \"http://test.org/identifier/test-poc\",\n            \"value\": \"{{$guid}}\"\n          },\n          {\n            \"system\": \"https://instantopenhie.org/client{{randomClientId}}\",\n            \"value\": \"{{$guid}}\"\n          }\n        ],\n        \"active\": true,\n        \"name\": [\n          {\n            \"given\": [\n              \"{{$randomFirstName}}\"\n            ]\n          },\n          {\n            \"family\": \"{{$randomLastName}}\"\n          }\n        ],\n        \"gender\": \"{{gender}}\",\n        \"birthDate\": \"{{dob}}\"\n      },\n      \"request\": {\n        \"method\": \"POST\"\n      }\n    },\n    {\n      \"fullUrl\": \"\",\n      \"resource\": {\n        \"resourceType\": \"Condition\",\n        \"meta\": {\n          \"profile\": [\n            \"http://openhie.org/fhir/StructureDefinition/hiv-condition\"\n          ]\n        },\n        \"clinicalStatus\": {\n          \"coding\": [\n            {\n              \"code\": \"active\"\n            }\n          ]\n        },\n        \"verificationStatus\": {\n          \"coding\": [\n            {\n              \"code\": \"confirmed\"\n            }\n          ]\n        },\n        \"code\": {\n          \"coding\": [\n            {\n              \"code\": \"86406008\",\n              \"system\": \"http://snomed.info/sct\"\n            }\n          ]\n        },\n        \"subject\": {\n          \"reference\": \"Patient/hiv-patient\"\n        }\n      },\n      \"request\": {\n        \"method\": \"POST\"\n      }\n    },\n    {\n      \"fullUrl\": \"\",\n      \"resource\": {\n        \"resourceType\": \"MedicationStatement\",\n        \"meta\": {\n          \"profile\": [\n            \"http://openhie.org/fhir/StructureDefinition/arv-therapy-summary\"\n          ]\n        },\n        \"status\": \"active\",\n        \"medicationCodeableConcept\": {\n          \"coding\": [\n            {\n              \"code\": \"ART\",\n              \"system\": \"http://test.org/medication-type\",\n              \"display\": \"Antiretrovirals\"\n            }\n          ]\n        },\n        \"subject\": {\n          \"reference\": \"Patient/hiv-patient\"\n        }\n      },\n      \"request\": {\n        \"method\": \"POST\"\n      }\n    },\n    {\n      \"fullUrl\": \"\",\n      \"resource\": {\n        \"resourceType\": \"Observation\",\n        \"meta\": {\n          \"profile\": [\n            \"http://openhie.org/fhir/StructureDefinition/hiv-viral-load\"\n          ]\n        },\n        \"status\": \"final\",\n        \"code\": {\n          \"coding\": [\n            {\n              \"code\": \"VL-RESULT\",\n              \"system\": \"http://test.org/obs\",\n              \"display\": \"Viral load result\"\n            }\n          ]\n        },\n        \"subject\": {\n          \"reference\": \"Patient/hiv-patient\"\n        },\n        \"valueCodeableConcept\": {\n          \"coding\": [\n            {\n              \"code\": \"{{vlCode}}\",\n              \"system\": \"http://test.org/obs/vl-result\",\n              \"display\": \"{{vlDisplay}}\"\n            }\n          ]\n        }\n      },\n      \"request\": {\n        \"method\": \"POST\"\n      }\n    }\n  ]\n}\n",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "http://localhost:5001/fhir",
							"protocol": "http",
							"host": [
								"localhost"
							],
							"port": "5001",
							"path": [
								"fhir"
							]
						}
					},
					"response": []
				},
				{
					"name": "All events, duplicate patient - client 1",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"type": "text",
								"value": "application/fhir+json"
							},
							{
								"key": "Authorization",
								"type": "text",
								"value": "Custom test"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"resourceType\": \"Bundle\",\n  \"type\": \"transaction\",\n  \"entry\": [\n    {\n      \"resource\": {\n        \"resourceType\": \"Composition\",\n        \"patient\": {\n          \"reference\": \"Patient/hiv-patient\"\n        }\n      },\n      \"request\": {\n        \"method\": \"POST\"\n      }\n    },\n    {\n      \"fullUrl\": \"\",\n      \"resource\": {\n        \"resourceType\": \"Patient\",\n        \"meta\": {\n          \"profile\": [\n            \"http://openhie.org/fhir/StructureDefinition/hiv-patient\"\n          ]\n        },\n        \"identifier\": [\n          {\n            \"system\": \"http://test.org/identifier/test-poc\",\n            \"value\": \"{{$guid}}\"\n          },\n          {\n            \"system\": \"https://instantopenhie.org/client1\",\n            \"value\": \"121212\"\n          }\n        ],\n        \"active\": true,\n        \"name\": [\n          {\n            \"given\": [\n              \"John\"\n            ]\n          },\n          {\n            \"family\": \"Snow\"\n          }\n        ],\n        \"gender\": \"male\",\n        \"birthDate\": \"1990-01-02\"\n      },\n      \"request\": {\n        \"method\": \"POST\"\n      }\n    },\n    {\n      \"fullUrl\": \"\",\n      \"resource\": {\n        \"resourceType\": \"Condition\",\n        \"meta\": {\n          \"profile\": [\n            \"http://openhie.org/fhir/StructureDefinition/hiv-condition\"\n          ]\n        },\n        \"clinicalStatus\": {\n          \"coding\": [\n            {\n              \"code\": \"active\"\n            }\n          ]\n        },\n        \"verificationStatus\": {\n          \"coding\": [\n            {\n              \"code\": \"confirmed\"\n            }\n          ]\n        },\n        \"code\": {\n          \"coding\": [\n            {\n              \"code\": \"86406008\",\n              \"system\": \"http://snomed.info/sct\"\n            }\n          ]\n        },\n        \"subject\": {\n          \"reference\": \"Patient/hiv-patient\"\n        }\n      },\n      \"request\": {\n        \"method\": \"POST\"\n      }\n    },\n    {\n      \"fullUrl\": \"\",\n      \"resource\": {\n        \"resourceType\": \"MedicationStatement\",\n        \"meta\": {\n          \"profile\": [\n            \"http://openhie.org/fhir/StructureDefinition/arv-therapy-summary\"\n          ]\n        },\n        \"status\": \"active\",\n        \"medicationCodeableConcept\": {\n          \"coding\": [\n            {\n              \"code\": \"ART\",\n              \"system\": \"http://test.org/medication-type\",\n              \"display\": \"Antiretrovirals\"\n            }\n          ]\n        },\n        \"subject\": {\n          \"reference\": \"Patient/hiv-patient\"\n        }\n      },\n      \"request\": {\n        \"method\": \"POST\"\n      }\n    },\n    {\n      \"fullUrl\": \"\",\n      \"resource\": {\n        \"resourceType\": \"Observation\",\n        \"meta\": {\n          \"profile\": [\n            \"http://openhie.org/fhir/StructureDefinition/hiv-viral-load\"\n          ]\n        },\n        \"status\": \"final\",\n        \"code\": {\n          \"coding\": [\n            {\n              \"code\": \"VL-RESULT\",\n              \"system\": \"http://test.org/obs\",\n              \"display\": \"Viral load result\"\n            }\n          ]\n        },\n        \"subject\": {\n          \"reference\": \"Patient/hiv-patient\"\n        },\n        \"valueCodeableConcept\": {\n          \"coding\": [\n            {\n              \"code\": \"{{vlCode}}\",\n              \"system\": \"http://test.org/obs/vl-result\",\n              \"display\": \"{{vlDisplay}}\"\n            }\n          ]\n        }\n      },\n      \"request\": {\n        \"method\": \"POST\"\n      }\n    }\n  ]\n}\n",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "http://localhost:5001/fhir",
							"protocol": "http",
							"host": [
								"localhost"
							],
							"port": "5001",
							"path": [
								"fhir"
							]
						}
					},
					"response": []
				},
				{
					"name": "All events, duplicate patient - client 2",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"type": "text",
								"value": "application/fhir+json"
							},
							{
								"key": "Authorization",
								"type": "text",
								"value": "Custom test"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"resourceType\": \"Bundle\",\n  \"type\": \"transaction\",\n  \"entry\": [\n    {\n      \"resource\": {\n        \"resourceType\": \"Composition\",\n        \"patient\": {\n          \"reference\": \"Patient/hiv-patient\"\n        }\n      },\n      \"request\": {\n        \"method\": \"POST\"\n      }\n    },\n    {\n      \"fullUrl\": \"\",\n      \"resource\": {\n        \"resourceType\": \"Patient\",\n        \"meta\": {\n          \"profile\": [\n            \"http://openhie.org/fhir/StructureDefinition/hiv-patient\"\n          ]\n        },\n        \"identifier\": [\n          {\n            \"system\": \"http://test.org/identifier/test-poc\",\n            \"value\": \"{{$guid}}\"\n          },\n          {\n            \"system\": \"https://instantopenhie.org/client1\",\n            \"value\": \"121212\"\n          }\n        ],\n        \"active\": true,\n        \"name\": [\n          {\n            \"given\": [\n              \"John\"\n            ]\n          },\n          {\n            \"family\": \"Snow\"\n          }\n        ],\n        \"gender\": \"male\",\n        \"birthDate\": \"1990-01-02\"\n      },\n      \"request\": {\n        \"method\": \"POST\"\n      }\n    },\n    {\n      \"fullUrl\": \"\",\n      \"resource\": {\n        \"resourceType\": \"Condition\",\n        \"meta\": {\n          \"profile\": [\n            \"http://openhie.org/fhir/StructureDefinition/hiv-condition\"\n          ]\n        },\n        \"clinicalStatus\": {\n          \"coding\": [\n            {\n              \"code\": \"active\"\n            }\n          ]\n        },\n        \"verificationStatus\": {\n          \"coding\": [\n            {\n              \"code\": \"confirmed\"\n            }\n          ]\n        },\n        \"code\": {\n          \"coding\": [\n            {\n              \"code\": \"86406008\",\n              \"system\": \"http://snomed.info/sct\"\n            }\n          ]\n        },\n        \"subject\": {\n          \"reference\": \"Patient/hiv-patient\"\n        }\n      },\n      \"request\": {\n        \"method\": \"POST\"\n      }\n    },\n    {\n      \"fullUrl\": \"\",\n      \"resource\": {\n        \"resourceType\": \"MedicationStatement\",\n        \"meta\": {\n          \"profile\": [\n            \"http://openhie.org/fhir/StructureDefinition/arv-therapy-summary\"\n          ]\n        },\n        \"status\": \"active\",\n        \"medicationCodeableConcept\": {\n          \"coding\": [\n            {\n              \"code\": \"ART\",\n              \"system\": \"http://test.org/medication-type\",\n              \"display\": \"Antiretrovirals\"\n            }\n          ]\n        },\n        \"subject\": {\n          \"reference\": \"Patient/hiv-patient\"\n        }\n      },\n      \"request\": {\n        \"method\": \"POST\"\n      }\n    },\n    {\n      \"fullUrl\": \"\",\n      \"resource\": {\n        \"resourceType\": \"Observation\",\n        \"meta\": {\n          \"profile\": [\n            \"http://openhie.org/fhir/StructureDefinition/hiv-viral-load\"\n          ]\n        },\n        \"status\": \"final\",\n        \"code\": {\n          \"coding\": [\n            {\n              \"code\": \"VL-RESULT\",\n              \"system\": \"http://test.org/obs\",\n              \"display\": \"Viral load result\"\n            }\n          ]\n        },\n        \"subject\": {\n          \"reference\": \"Patient/hiv-patient\"\n        },\n        \"valueCodeableConcept\": {\n          \"coding\": [\n            {\n              \"code\": \"{{vlCode}}\",\n              \"system\": \"http://test.org/obs/vl-result\",\n              \"display\": \"{{vlDisplay}}\"\n            }\n          ]\n        }\n      },\n      \"request\": {\n        \"method\": \"POST\"\n      }\n    }\n  ]\n}\n",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "http://localhost:5001/fhir",
							"protocol": "http",
							"host": [
								"localhost"
							],
							"port": "5001",
							"path": [
								"fhir"
							]
						}
					},
					"response": []
				},
				{
					"name": "All events, external patient reference",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"type": "text",
								"value": "application/fhir+json"
							},
							{
								"key": "Authorization",
								"type": "text",
								"value": "Custom test"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"resourceType\": \"Bundle\",\n  \"type\": \"transaction\",\n  \"entry\": [\n    {\n      \"resource\": {\n        \"resourceType\": \"Composition\",\n        \"patient\": {\n          \"reference\": \"{{extPatientRef}}\"\n        }\n      },\n      \"request\": {\n        \"method\": \"POST\"\n      }\n    },\n    {\n      \"fullUrl\": \"\",\n      \"resource\": {\n        \"resourceType\": \"Condition\",\n        \"meta\": {\n          \"profile\": [\n            \"http://openhie.org/fhir/StructureDefinition/hiv-condition\"\n          ]\n        },\n        \"clinicalStatus\": {\n          \"coding\": [\n            {\n              \"code\": \"active\"\n            }\n          ]\n        },\n        \"verificationStatus\": {\n          \"coding\": [\n            {\n              \"code\": \"confirmed\"\n            }\n          ]\n        },\n        \"code\": {\n          \"coding\": [\n            {\n              \"code\": \"86406008\",\n              \"system\": \"http://snomed.info/sct\"\n            }\n          ]\n        },\n        \"subject\": {\n          \"reference\": \"{{extPatientRef}}\"\n        }\n      },\n      \"request\": {\n        \"method\": \"POST\"\n      }\n    },\n    {\n      \"fullUrl\": \"\",\n      \"resource\": {\n        \"resourceType\": \"MedicationStatement\",\n        \"meta\": {\n          \"profile\": [\n            \"http://openhie.org/fhir/StructureDefinition/arv-therapy-summary\"\n          ]\n        },\n        \"status\": \"active\",\n        \"medicationCodeableConcept\": {\n          \"coding\": [\n            {\n              \"code\": \"ART\",\n              \"system\": \"http://test.org/medication-type\",\n              \"display\": \"Antiretrovirals\"\n            }\n          ]\n        },\n        \"subject\": {\n          \"reference\": \"{{extPatientRef}}\"\n        }\n      },\n      \"request\": {\n        \"method\": \"POST\"\n      }\n    },\n    {\n      \"fullUrl\": \"\",\n      \"resource\": {\n        \"resourceType\": \"Observation\",\n        \"meta\": {\n          \"profile\": [\n            \"http://openhie.org/fhir/StructureDefinition/hiv-viral-load\"\n          ]\n        },\n        \"status\": \"final\",\n        \"code\": {\n          \"coding\": [\n            {\n              \"code\": \"VL-RESULT\",\n              \"system\": \"http://test.org/obs\",\n              \"display\": \"Viral load result\"\n            }\n          ]\n        },\n        \"subject\": {\n          \"reference\": \"{{extPatientRef}}\"\n        },\n        \"valueCodeableConcept\": {\n          \"coding\": [\n            {\n              \"code\": \"{{vlCode}}\",\n              \"system\": \"http://test.org/obs/vl-result\",\n              \"display\": \"{{vlDisplay}}\"\n            }\n          ]\n        }\n      },\n      \"request\": {\n        \"method\": \"POST\"\n      }\n    }\n  ]\n}\n",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "http://localhost:5001/fhir",
							"protocol": "http",
							"host": [
								"localhost"
							],
							"port": "5001",
							"path": [
								"fhir"
							]
						}
					},
					"response": []
				},
				{
					"name": "All events, invalid external patient reference",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"type": "text",
								"value": "application/fhir+json"
							},
							{
								"key": "Authorization",
								"type": "text",
								"value": "Custom test"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"resourceType\": \"Bundle\",\n  \"type\": \"transaction\",\n  \"entry\": [\n    {\n      \"resource\": {\n        \"resourceType\": \"Composition\",\n        \"patient\": {\n          \"reference\": \"Patient/555\"\n        }\n      },\n      \"request\": {\n        \"method\": \"POST\"\n      }\n    },\n    {\n      \"fullUrl\": \"\",\n      \"resource\": {\n        \"resourceType\": \"Condition\",\n        \"meta\": {\n          \"profile\": [\n            \"http://openhie.org/fhir/StructureDefinition/hiv-condition\"\n          ]\n        },\n        \"clinicalStatus\": {\n          \"coding\": [\n            {\n              \"code\": \"active\"\n            }\n          ]\n        },\n        \"verificationStatus\": {\n          \"coding\": [\n            {\n              \"code\": \"confirmed\"\n            }\n          ]\n        },\n        \"code\": {\n          \"coding\": [\n            {\n              \"code\": \"86406008\",\n              \"system\": \"http://snomed.info/sct\"\n            }\n          ]\n        },\n        \"subject\": {\n          \"reference\": \"Patient/555\"\n        }\n      },\n      \"request\": {\n        \"method\": \"POST\"\n      }\n    },\n    {\n      \"fullUrl\": \"\",\n      \"resource\": {\n        \"resourceType\": \"MedicationStatement\",\n        \"meta\": {\n          \"profile\": [\n            \"http://openhie.org/fhir/StructureDefinition/arv-therapy-summary\"\n          ]\n        },\n        \"status\": \"active\",\n        \"medicationCodeableConcept\": {\n          \"coding\": [\n            {\n              \"code\": \"ART\",\n              \"system\": \"http://test.org/medication-type\",\n              \"display\": \"Antiretrovirals\"\n            }\n          ]\n        },\n        \"subject\": {\n          \"reference\": \"Patient/555\"\n        }\n      },\n      \"request\": {\n        \"method\": \"POST\"\n      }\n    },\n    {\n      \"fullUrl\": \"\",\n      \"resource\": {\n        \"resourceType\": \"Observation\",\n        \"meta\": {\n          \"profile\": [\n            \"http://openhie.org/fhir/StructureDefinition/hiv-viral-load\"\n          ]\n        },\n        \"status\": \"final\",\n        \"code\": {\n          \"coding\": [\n            {\n              \"code\": \"VL-RESULT\",\n              \"system\": \"http://test.org/obs\",\n              \"display\": \"Viral load result\"\n            }\n          ]\n        },\n        \"subject\": {\n          \"reference\": \"Patient/555\"\n        },\n        \"valueCodeableConcept\": {\n          \"coding\": [\n            {\n              \"code\": \"{{vlCode}}\",\n              \"system\": \"http://test.org/obs/vl-result\",\n              \"display\": \"{{vlDisplay}}\"\n            }\n          ]\n        }\n      },\n      \"request\": {\n        \"method\": \"POST\"\n      }\n    }\n  ]\n}\n",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "http://localhost:5001/fhir",
							"protocol": "http",
							"host": [
								"localhost"
							],
							"port": "5001",
							"path": [
								"fhir"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "Mapping mediator WIP",
			"item": [
				{
					"name": "Get mapping mediator endpoints",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "http://localhost:3003/endpoints",
							"protocol": "http",
							"host": [
								"localhost"
							],
							"port": "3003",
							"path": [
								"endpoints"
							]
						}
					},
					"response": []
				},
				{
					"name": "Endpoint - validate-identity",
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"name\": \"CR Orchestration of a clinical bundle\",\n    \"description\": \"\",\n    \"endpoint\": {\n        \"method\": \"POST\",\n        \"pattern\": \"/orchestrate-bundle\"\n    },\n    \"transformation\": {\n        \"input\": \"JSON\",\n        \"output\": \"JSON\"\n    },\n    \"inputMapping\": {\n        \"resourecType\": \"resourceType\",\n        \"type\": \"type\",\n        \"entry\": \"entry\"\n    },\n    \"inputTransforms\": {\n        \"identityStatus\": \"$exists(entry[resource.resourceType='Patient']) ? 'create' : 'validate'\",\n        \"patientRef\": \"entry[resource.resourceType='Composition'].resource.patient.reference\"\n    },\n    \"requests\": {\n        \"lookup\": [],\n        \"response\": [\n            {\n                \"id\": \"validateIdentity\",\n                \"config\": {\n                    \"method\": \"GET\",\n                    \"url\": \"http://mapping-mediator:3003/identity/:status\",\n                    \"params\": {\n                        \"url\": {\n                            \"status\": {\n                                \"path\": \"transforms.identityStatus\"\n                            }\n                        },\n                        \"query\": {\n                            \"patientRef\": {\n                                \"path\": \"transforms.patientRef\"\n                            }\n                        }\n                    }\n                }\n            }\n        ]\n    },\n    \"state\": {\n        \"config\": {\n            \"networkErrors\": \"no-filter\",\n            \"includeStatuses\": []\n        }\n    },\n    \"constants\": {}\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "http://localhost:3003/endpoints",
							"protocol": "http",
							"host": [
								"localhost"
							],
							"port": "3003",
							"path": [
								"endpoints"
							]
						}
					},
					"response": []
				},
				{
					"name": "Endpoint - identity-create",
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"name\": \"Create identity\",\n    \"description\": \"\",\n    \"endpoint\": {\n        \"method\": \"POST\",\n        \"pattern\": \"/identity/create\"\n    },\n    \"transformation\": {\n        \"input\": \"JSON\",\n        \"output\": \"JSON\"\n    },\n    \"inputMapping\": {\n        ??\n    },\n    \"inputTransforms\": {\n        \"patient\": \"entry[resource.resourceType='Patient'].resource\",\n        \"strippedEntries\": \"entry[resource.resourceType!='Patient']\"\n    },\n    \"requests\": {\n        \"lookup\": [\n        ],\n        \"response\": [\n            {\n                \"id\": \"createPatient\",\n                \"config\": {\n                    \"method\": \"POST\",\n                    \"url\": \"http://client:3447/fhir/Patient\"\n                }\n            }\n        ]\n    },\n    \"state\": {\n        \"config\": {\n            \"networkErrors\": \"no-filter\",\n            \"includeStatuses\": []\n        }\n    },\n    \"constants\": {}\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "http://localhost:3003/endpoints",
							"protocol": "http",
							"host": [
								"localhost"
							],
							"port": "3003",
							"path": [
								"endpoints"
							]
						}
					},
					"response": []
				},
				{
					"name": "Endpoint - identity-validate",
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"name\": \"Validate identity\",\n    \"description\": \"\",\n    \"endpoint\": {\n        \"method\": \"POST\",\n        \"pattern\": \"/identity/validate\"\n    },\n    \"transformation\": {\n        \"input\": \"JSON\",\n        \"output\": \"JSON\"\n    },\n    \"inputMapping\": {},\n    \"inputTransforms\": {\n        \"identityStatus\": \"$exists(lookupRequests.validateIdentity.id) ? 'valid' : 'invalid'\"\n    },\n    \"requests\": {\n        \"lookup\": [\n            {\n                \"id\": \"validateIdentity\",\n                \"config\": {\n                    \"method\": \"GET\",\n                    \"url\": \"http://client:3447/fhir/:patientRef\",\n                    \"params\": {\n                        \"url\": {\n                            \"patientRef\": {\n                                \"path\": \"query.patientRef\"\n                            }\n                        }\n                    }\n                }\n            }\n        ],\n        \"response\": [\n            {\n                \"id\": \"submitBundle\",\n                \"config\": {\n                    \"method\": \"POST\",\n                    \"url\": \"http://hapi-fhir:3447/fhir\"\n                }\n            }\n        ]\n    },\n    \"state\": {\n        \"config\": {\n            \"networkErrors\": \"no-filter\",\n            \"includeStatuses\": []\n        }\n    },\n    \"constants\": {}\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "http://localhost:3003/endpoints",
							"protocol": "http",
							"host": [
								"localhost"
							],
							"port": "3003",
							"path": [
								"endpoints"
							]
						}
					},
					"response": []
				}
			]
		}
	],
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"type": "text/javascript",
				"exec": [
					"function getRandomInt(min, max) {",
					"    min = Math.ceil(min);",
					"    max = Math.floor(max);",
					"    return Math.floor(Math.random() * (max - min + 1)) + min;",
					"}",
					"",
					"const moment = require('moment');",
					"pm.variables.set('dob', moment().subtract((Math.random() * 50) + 18, 'years').format('YYYY-MM-DD'));",
					"",
					"const gender = ['male', 'female']",
					"pm.variables.set('gender', gender[getRandomInt(0, 1)])",
					"",
					"const vl = [['<200', 'less than 200 - undetectable'], ['200-1000', '200 - 1000 - detectable'], ['>1000', 'greather than 1000 - detectable']]",
					"const vlIndex = getRandomInt(0, 2)",
					"pm.variables.set('vlCode', vl[vlIndex][0])",
					"pm.variables.set('vlDisplay', vl[vlIndex][1])",
					"",
					"pm.variables.set('randomClientId', getRandomInt(1,3))",
					""
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"type": "text/javascript",
				"exec": [
					""
				]
			}
		}
	],
	"variable": [
		{
			"key": "extPatientRef",
			"value": "Patient/123"
		}
	]
}