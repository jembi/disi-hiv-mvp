{
	"info": {
		"_postman_id": "b1feeeb5-1b9b-418c-aed1-9b38b01abe24",
		"name": "DISI CDR",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "Bootstrap",
			"item": []
		},
		{
			"name": "MPI interactions",
			"item": [
				{
					"name": "Register random patient",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"let headerValue = pm.response.headers.get(\"location\")",
									"pm.collectionVariables.set(\"extPatientRef\", headerValue);",
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"type": "text",
								"value": "application/fhir+json"
							},
							{
								"key": "Authorization",
								"type": "text",
								"value": "Custom test"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"resourceType\": \"Patient\",\n    \"meta\": {\n        \"profile\": [\n            \"http://openhie.org/fhir/StructureDefinition/hiv-patient\"\n        ]\n    },\n    \"identifier\": [\n        {\n            \"system\": \"http://openclientregistry.org/fhir/sourceid\",\n            \"value\": \"client{{randomClientId}}-{{$guid}}\"\n        }\n    ],\n    \"active\": true,\n    \"name\": [\n        {\n            \"use\": \"official\",\n            \"given\": [\n                \"{{$randomFirstName}}\"\n            ],\n            \"family\": \"{{$randomLastName}}\"\n        }\n    ],\n    \"gender\": \"{{gender}}\",\n    \"birthDate\": \"{{dob}}\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "http://{{openhimHost}}:{{openhimPort}}/client/Patient",
							"protocol": "http",
							"host": [
								"{{openhimHost}}"
							],
							"port": "{{openhimPort}}",
							"path": [
								"client",
								"Patient"
							]
						}
					},
					"response": []
				},
				{
					"name": "Register duplicate patient - facility 1",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"let headerValue = pm.response.headers.get(\"location\")",
									"pm.collectionVariables.set(\"extPatientRef\", headerValue);",
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"type": "text",
								"value": "application/fhir+json"
							},
							{
								"key": "Authorization",
								"type": "text",
								"value": "Custom test"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"resourceType\": \"Patient\",\n    \"meta\": {\n        \"profile\": [\n            \"http://openhie.org/fhir/StructureDefinition/hiv-patient\"\n        ]\n    },\n    \"identifier\": [\n        {\n            \"system\": \"http://openclientregistry.org/fhir/sourceid\",\n            \"value\": \"client1-1111111111\"\n        }\n    ],\n    \"active\": true,\n    \"name\": [\n        {\n            \"use\": \"official\",\n            \"given\": [\n                \"Jane\"\n            ],\n            \"family\": \"Smith\"\n        }\n    ],\n    \"gender\": \"female\",\n    \"birthDate\": \"1986-06-04\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "http://{{openhimHost}}:{{openhimPort}}/client/Patient",
							"protocol": "http",
							"host": [
								"{{openhimHost}}"
							],
							"port": "{{openhimPort}}",
							"path": [
								"client",
								"Patient"
							]
						}
					},
					"response": []
				},
				{
					"name": "Register duplicate patient - facility 2",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"let headerValue = pm.response.headers.get(\"location\")",
									"pm.collectionVariables.set(\"extPatientRef\", headerValue);",
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"type": "text",
								"value": "application/fhir+json"
							},
							{
								"key": "Authorization",
								"type": "text",
								"value": "Custom test"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"resourceType\": \"Patient\",\n    \"meta\": {\n        \"profile\": [\n            \"http://openhie.org/fhir/StructureDefinition/hiv-patient\"\n        ]\n    },\n    \"identifier\": [\n        {\n            \"system\": \"http://openclientregistry.org/fhir/sourceid\",\n            \"value\": \"client2-2222222222\"\n        }\n    ],\n    \"active\": true,\n    \"name\": [\n        {\n            \"use\": \"official\",\n            \"given\": [\n                \"Jaane\"\n            ],\n            \"family\": \"Smiith\"\n        }\n    ],\n    \"gender\": \"female\",\n    \"birthDate\": \"1986-06-04\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "http://{{openhimHost}}:{{openhimPort}}/client/Patient",
							"protocol": "http",
							"host": [
								"{{openhimHost}}"
							],
							"port": "{{openhimPort}}",
							"path": [
								"client",
								"Patient"
							]
						}
					},
					"response": []
				},
				{
					"name": "Register duplicate patient - facility 3 - (manual link)",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"let headerValue = pm.response.headers.get(\"location\")",
									"pm.collectionVariables.set(\"extPatientRef\", headerValue);",
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"type": "text",
								"value": "application/fhir+json"
							},
							{
								"key": "Authorization",
								"type": "text",
								"value": "Custom test"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"resourceType\": \"Patient\",\n    \"meta\": {\n        \"profile\": [\n            \"http://openhie.org/fhir/StructureDefinition/hiv-patient\"\n        ]\n    },\n    \"identifier\": [\n        {\n            \"system\": \"http://openclientregistry.org/fhir/sourceid\",\n            \"value\": \"client3-3333333333\"\n        }\n    ],\n    \"active\": true,\n    \"name\": [\n        {\n            \"use\": \"official\",\n            \"given\": [\n                \"Jan\"\n            ],\n            \"family\": \"Smthxxyz\"\n        }\n    ],\n    \"gender\": \"female\",\n    \"birthDate\": \"1986-06-04\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "http://{{openhimHost}}:{{openhimPort}}/client/Patient",
							"protocol": "http",
							"host": [
								"{{openhimHost}}"
							],
							"port": "{{openhimPort}}",
							"path": [
								"client",
								"Patient"
							]
						},
						"description": "Will create a patient that needs manual action to be matched with other patients from the request above in OpenCR."
					},
					"response": []
				}
			]
		},
		{
			"name": "Submit bundle",
			"item": [
				{
					"name": "Submit static bundle",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/fhir+json",
								"type": "text"
							},
							{
								"key": "Authorization",
								"value": "Custom test",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"resourceType\": \"Bundle\",\n  \"id\": \"HIVBundleExample\",\n  \"type\": \"transaction\",\n  \"entry\": [\n    {\n      \"fullUrl\": \"http://test.org/fhir/Composition/HIVCompositionExample\",\n      \"resource\": {\n        \"resourceType\": \"Composition\",\n        \"id\": \"HIVCompositionExample\",\n        \"meta\": {\n          \"profile\": [\n            \"http://openhie.org/fhir/hiv-casereporting/StructureDefinition/hiv-composition\"\n          ]\n        },\n        \"type\": {\n          \"coding\": [\n            {\n              \"code\": \"95412-3\",\n              \"system\": \"http://loinc.org\"\n            }\n          ]\n        },\n        \"status\": \"final\",\n        \"identifier\": {\n          \"system\": \"http://test.org/identifier/hiv-case-report\",\n          \"value\": \"1111\"\n        },\n        \"encounter\": {\n          \"reference\": \"Encounter/HIVEncounterExample\"\n        },\n        \"date\": \"2021-05-18\",\n        \"title\": \"HIV Case Report\",\n        \"section\": [\n          {\n            \"title\": \"hivPatient\",\n            \"code\": {\n              \"coding\": [\n                {\n                  \"code\": \"hivPatient\",\n                  \"system\": \"http://test.org/sectionCode\"\n                }\n              ]\n            },\n            \"entry\": [\n              {\n                \"reference\": \"Patient/HIVPatientExample\"\n              }\n            ]\n          },\n          {\n            \"title\": \"maritalStatus\",\n            \"code\": {\n              \"coding\": [\n                {\n                  \"code\": \"maritalStatus\",\n                  \"system\": \"http://test.org/sectionCode\"\n                }\n              ]\n            },\n            \"entry\": [\n              {\n                \"reference\": \"Observation/MaritalStatusExample\"\n              }\n            ]\n          },\n          {\n            \"title\": \"hivDiagnosis\",\n            \"code\": {\n              \"coding\": [\n                {\n                  \"code\": \"hivDiagnosis\",\n                  \"system\": \"http://test.org/sectionCode\"\n                }\n              ]\n            },\n            \"entry\": [\n              {\n                \"reference\": \"Condition/HIVDiagnosisExample\"\n              }\n            ]\n          },\n          {\n            \"title\": \"viralLoad\",\n            \"code\": {\n              \"coding\": [\n                {\n                  \"code\": \"viralLoad\",\n                  \"system\": \"http://test.org/sectionCode\"\n                }\n              ]\n            },\n            \"entry\": [\n              {\n                \"reference\": \"Observation/ViralLoadExample\"\n              }\n            ]\n          },\n          {\n            \"title\": \"cd4\",\n            \"code\": {\n              \"coding\": [\n                {\n                  \"code\": \"cd4\",\n                  \"system\": \"http://test.org/sectionCode\"\n                }\n              ]\n            },\n            \"entry\": [\n              {\n                \"reference\": \"Observation/CD4Example\"\n              }\n            ]\n          }\n        ]\n      },\n      \"request\": {\n        \"method\": \"POST\"\n      }\n    },\n    {\n      \"fullUrl\": \"http://test.org/fhir/Encounter/HIVEncounterExample\",\n      \"resource\": {\n        \"resourceType\": \"Encounter\",\n        \"id\": \"HIVEncounterExample\",\n        \"location\": [\n          {\n            \"location\": {\n              \"reference\": \"Location/HIVLocationExample\"\n            }\n          }\n        ],\n        \"status\": \"finished\",\n        \"class\": {\n          \"code\": \"ACUTE\",\n          \"system\": \"http://terminology.hl7.org/CodeSystem/v3-ActCode\"\n        },\n        \"period\": {\n          \"start\": \"2021-05-20\",\n          \"end\": \"2021-05-20\"\n        }\n      },\n      \"request\": {\n        \"method\": \"POST\"\n      }\n    },\n    {\n      \"fullUrl\": \"http://test.org/fhir/Location/HIVLocationExample\",\n      \"resource\": {\n        \"resourceType\": \"Location\",\n        \"id\": \"HIVLocationExample\",\n        \"address\": {\n          \"country\": \"ZA\",\n          \"state\": \"KZN\"\n        }\n      },\n      \"request\": {\n        \"method\": \"POST\"\n      }\n    },\n    {\n      \"fullUrl\": \"http://test.org/fhir/Patient/HIVPatientExample\",\n      \"resource\": {\n        \"resourceType\": \"Patient\",\n        \"id\": \"HIVPatientExample\",\n        \"meta\": {\n          \"profile\": [\n            \"http://openhie.org/fhir/hiv-casereporting/StructureDefinition/hiv-patient\"\n          ]\n        },\n        \"extension\": [\n          {\n            \"url\": \"http://openhie.org/fhir/hiv-casereporting/StructureDefinition/gender-identity\",\n            \"valueCodeableConcept\": {\n              \"coding\": [\n                {\n                  \"code\": \"{{gender}}\"\n                }\n              ]\n            }\n          },\n          {\n            \"url\": \"http://openhie.org/fhir/hiv-casereporting/StructureDefinition/key-population\",\n            \"valueCodeableConcept\": {\n              \"coding\": [\n                {\n                  \"code\": \"transgender\"\n                }\n              ]\n            }\n          }\n        ],\n        \"active\": true,\n        \"name\": [\n          {\n            \"given\": [\n              \"Jane\"\n            ],\n            \"family\": \"Smith\"\n          }\n        ],\n        \"gender\": \"{{gender}}\",\n        \"birthDate\": \"{{dob}}\",\n        \"telecom\": [\n          {\n            \"system\": \"phone\",\n            \"value\": \"+27825556666\"\n          }\n        ],\n        \"address\": [\n          {\n            \"country\": \"South Africa\",\n            \"state\": \"Western Province\",\n            \"district\": \"City of Cape Town\",\n            \"city\": \"Cape Town\"\n          }\n        ],\n        \"identifier\": [\n          {\n            \"value\": \"ART1234567\"\n          },\n          {\n            \"value\": \"NAT1234567\"\n          },\n          {\n            \"value\": \"EMR1234567\"\n          }\n        ],\n        \"link\": [\n          {\n            \"other\": {\n              \"reference\": \"RelatedPerson/GuardianExample\"\n            },\n            \"type\": \"seealso\"\n          }\n        ]\n      },\n      \"request\": {\n        \"method\": \"POST\"\n      }\n    },\n    {\n      \"fullUrl\": \"http://test.org/fhir/RelatedPerson/GuardianExample\",\n      \"resource\": {\n        \"resourceType\": \"RelatedPerson\",\n        \"id\": \"GuardianExample\",\n        \"name\": [\n          {\n            \"given\": [\n              \"Peter\"\n            ],\n            \"family\": \"Loo\"\n          }\n        ],\n        \"patient\": {\n          \"reference\": \"Patient/HIVPatientExample\"\n        }\n      },\n      \"request\": {\n        \"method\": \"POST\"\n      }\n    },\n    {\n      \"fullUrl\": \"http://test.org/fhir/RelatedPerson/MaritalStatusExample\",\n      \"resource\": {\n        \"resourceType\": \"Observation\",\n        \"id\": \"MaritalStatusExample\",\n        \"meta\": {\n          \"profile\": [\n            \"http://openhie.org/fhir/hiv-casereporting/StructureDefinition/marital-status\"\n          ]\n        },\n        \"status\": \"final\",\n        \"code\": {\n          \"coding\": [\n            {\n              \"code\": \"M\",\n              \"display\": \"Married\"\n            }\n          ]\n        },\n        \"subject\": {\n          \"reference\": \"Patient/HIVPatientExample\"\n        },\n        \"valueCodeableConcept\": {\n          \"coding\": [\n            {\n              \"code\": \"M\",\n              \"display\": \"Married\"\n            }\n          ]\n        }\n      },\n      \"request\": {\n        \"method\": \"POST\"\n      }\n    },\n    {\n      \"fullUrl\": \"http://test.org/fhir/Condition/HIVDiagnosisExample\",\n      \"resource\": {\n        \"resourceType\": \"Condition\",\n        \"id\": \"HIVDiagnosisExample\",\n        \"meta\": {\n          \"profile\": [\n            \"http://openhie.org/fhir/hiv-casereporting/StructureDefinition/hiv-diagnosis\"\n          ]\n        },\n        \"clinicalStatus\": {\n          \"coding\": [\n            {\n              \"code\": \"active\"\n            }\n          ]\n        },\n        \"verificationStatus\": {\n          \"coding\": [\n            {\n              \"code\": \"confirmed\"\n            }\n          ]\n        },\n        \"code\": {\n          \"coding\": [\n            {\n              \"code\": \"86406008\",\n              \"system\": \"http://snomed.info/sct\"\n            }\n          ]\n        },\n        \"subject\": {\n          \"reference\": \"Patient/HIVPatientExample\"\n        }\n      },\n      \"request\": {\n        \"method\": \"POST\"\n      }\n    },\n    {\n      \"fullUrl\": \"http://test.org/fhir/CarePlan/ARVTreatmentExample\",\n      \"resource\": {\n        \"resourceType\": \"CarePlan\",\n        \"id\": \"ARVTreatmentExample\",\n        \"meta\": {\n          \"profile\": [\n            \"http://openhie.org/fhir/hiv-casereporting/StructureDefinition/hiv-arv-treatment\"\n          ]\n        },\n        \"status\": \"active\",\n        \"intent\": \"plan\",\n        \"subject\": {\n          \"reference\": \"Patient/HIVPatientExample\"\n        },\n        \"period\": {\n          \"start\": \"2021-05-20\"\n        }\n      },\n      \"request\": {\n        \"method\": \"POST\"\n      }\n    },\n    {\n      \"fullUrl\": \"http://test.org/fhir/Observation/ViralLoadExample\",\n      \"resource\": {\n        \"resourceType\": \"Observation\",\n        \"id\": \"ViralLoadExample\",\n        \"meta\": {\n          \"profile\": [\n            \"http://openhie.org/fhir/hiv-casereporting/StructureDefinition/hiv-viral-load-test\"\n          ]\n        },\n        \"code\": {\n          \"coding\": [\n            {\n              \"code\": \"VL-RESULT\",\n              \"system\": \"http://test.org/obs\",\n              \"display\": \"Viral load result\"\n            }\n          ]\n        },\n        \"status\": \"final\",\n        \"subject\": {\n          \"reference\": \"Patient/HIVPatientExample\"\n        },\n        \"valueInteger\": 200,\n        \"interpretation\": [\n          {\n            \"coding\": [\n              {\n                \"code\": \"D\"\n              }\n            ]\n          }\n        ]\n      },\n      \"request\": {\n        \"method\": \"POST\"\n      }\n    },\n    {\n      \"fullUrl\": \"http://test.org/fhir/Observation/CD4Example\",\n      \"resource\": {\n        \"resourceType\": \"Observation\",\n        \"id\": \"CD4Example\",\n        \"meta\": {\n          \"profile\": [\n            \"http://openhie.org/fhir/hiv-casereporting/StructureDefinition/hiv-cd4-test\"\n          ]\n        },\n        \"code\": {\n          \"coding\": [\n            {\n              \"code\": \"CD4-RESULT\",\n              \"system\": \"http://test.org/obs\",\n              \"display\": \"CD4 result\"\n            }\n          ]\n        },\n        \"status\": \"final\",\n        \"subject\": {\n          \"reference\": \"Patient/HIVPatientExample\"\n        },\n        \"valueInteger\": 200\n      },\n      \"request\": {\n        \"method\": \"POST\"\n      }\n    }\n  ]\n}\n",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "http://{{openhimHost}}:{{openhimPort}}/fhir/",
							"protocol": "http",
							"host": [
								"{{openhimHost}}"
							],
							"port": "{{openhimPort}}",
							"path": [
								"fhir",
								""
							]
						},
						"description": "Remove author and ARVTherapySummaryExample section reference"
					},
					"response": []
				}
			]
		}
	],
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"type": "text/javascript",
				"exec": [
					"function getRandomInt(min, max) {",
					"    min = Math.ceil(min);",
					"    max = Math.floor(max);",
					"    return Math.floor(Math.random() * (max - min + 1)) + min;",
					"}",
					"",
					"const moment = require('moment');",
					"pm.variables.set('dob', moment().subtract((Math.random() * 50) + 18, 'years').format('YYYY-MM-DD'));",
					"",
					"const gender = ['male', 'female']",
					"pm.variables.set('gender', gender[getRandomInt(0, 1)])",
					""
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"type": "text/javascript",
				"exec": [
					""
				]
			}
		}
	],
	"variable": [
		{
			"key": "extPatientRef",
			"value": "Patient/123"
		},
		{
			"key": "localPatientID",
			"value": ""
		},
		{
			"key": "openhimHost",
			"value": "localhost"
		},
		{
			"key": "openhimPort",
			"value": "5001"
		}
	]
}