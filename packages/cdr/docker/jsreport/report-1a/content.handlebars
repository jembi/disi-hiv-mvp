<!DOCTYPE html>

<style>{#asset /css/styles.css @encoding=utf8}</style>

{{#unless totals.total}}
<h3 class="error">0 results returned for given report parameters</h3>
{{else}}
<div class="table-wrapper">
  <table class="styled-table">
    <thead>
      <tr class="table-header">
        <th colspan="4">New HIV diagnosis by age and sex</th>
      </tr>
      <tr>
        <th class="table-disagg">Age group</th>
        <th colspan="2" class="table-disagg">Sex</th>
        <th class="table-disagg">Total</th>
      </tr>
      <tr>
        <th></th>
        <th>Male</th>
        <th>Female</th>
        <th>N</th>
      </tr>
    </thead>
    <tbody>
      {{#each rows}}
      <tr>
        <td>{{ageGroup}}</td>
        <td>{{males}} ({{formatNumber malesPercent}}%)</td>
        <td>{{females}} ({{formatNumber femalesPercent}}%)</td>
        <td>{{total}} ({{formatNumber totalPercent}}%)</td>
      </tr>
      {{/each}}
    </tbody>
    <tfoot>
      {{#with totals}}
      <tr>
        <td>Total</td>
        <td>{{males}} ({{formatNumber malesPercent}}%)</td>
        <td>{{females}} ({{formatNumber femalesPercent}}%)</td>
        <td>{{total}} (100.0%)</td>
      </tr>
      {{/with}}
    </tfoot>
  </table>
</div>

<span id="data-serialized" style="display: none;">{{serialize .}}</span>

<div id="chartdiv1" class="chart box"></div>
<div id="chartdiv2" class="chart box"></div>
<div id="chartdiv3" class="chart box"></div>
{{/unless}}

<script>
  am4core.ready(function () {
    am4core.useTheme(am4themes_animated);
    const data = JSON.parse(document.getElementById('data-serialized').innerHTML)

    // chart 1
    var chart = am4core.create("chartdiv1", am4charts.XYChart);
    chart.data = data.rows

    var title = chart.titles.create();
    title.text = "New HIV diagnosis by age and sex";
    title.fontSize = 25;
    title.marginBottom = 30;

    var categoryAxis = chart.yAxes.push(new am4charts.CategoryAxis());
    categoryAxis.dataFields.category = "ageGroup";
    var valueAxis = chart.xAxes.push(new am4charts.ValueAxis());
    valueAxis.title.text = "HIV +ve %";

    var series1 = chart.series.push(new am4charts.ColumnSeries());
    series1.dataFields.valueX = "malesPercent";
    series1.dataFields.categoryY = "ageGroup";
    series1.stacked = true

    var series2 = chart.series.push(new am4charts.ColumnSeries());
    series2.dataFields.valueX = "femalesPercent";
    series2.dataFields.categoryY = "ageGroup";
    series2.stacked = true

    // chart 2
    var chart = am4core.create("chartdiv2", am4charts.XYChart);
    chart.data = data.rows

    var title = chart.titles.create();
    title.text = "New HIV diagnosis by age and sex";
    title.fontSize = 25;
    title.marginBottom = 30;

    var valueAxis = chart.yAxes.push(new am4charts.ValueAxis());
    var categoryAxis = chart.xAxes.push(new am4charts.CategoryAxis());
    categoryAxis.dataFields.category = "ageGroup";
    categoryAxis.renderer.grid.template.location = 0;
    categoryAxis.renderer.cellStartLocation = 0.1;
    categoryAxis.renderer.cellEndLocation = 0.9;
    categoryAxis.renderer.labels.template.rotation = -90;
    categoryAxis.renderer.minGridDistance = 20;

    var series1 = chart.series.push(new am4charts.ColumnSeries());
    series1.dataFields.categoryX = "ageGroup";
    series1.dataFields.valueY = "males";

    var series2 = chart.series.push(new am4charts.ColumnSeries());
    series2.dataFields.categoryX = "ageGroup";
    series2.dataFields.valueY = "females";

    // chart 3
    var chart = am4core.create("chartdiv3", am4charts.XYChart);
    chart.data = data.rows

    var title = chart.titles.create();
    title.text = "New HIV diagnosis by age and sex";
    title.fontSize = 25;
    title.marginBottom = 30;

    chart.bottomAxesContainer.layout = "horizontal";

    var valueAxis = chart.yAxes.push(new am4charts.ValueAxis());
    var categoryAxis1 = chart.xAxes.push(new am4charts.CategoryAxis());
    categoryAxis1.dataFields.category = "ageGroup";
    categoryAxis1.renderer.labels.template.rotation = -90;
    categoryAxis1.renderer.minGridDistance = 20;

    var series1 = chart.series.push(new am4charts.ColumnSeries());
    series1.dataFields.categoryX = "ageGroup";
    series1.dataFields.valueY = "males";
    series1.xAxis = categoryAxis1

    var categoryAxis2 = chart.xAxes.push(new am4charts.CategoryAxis());
    categoryAxis2.dataFields.category = "ageGroup";
    categoryAxis2.renderer.labels.template.rotation = -90;
    categoryAxis2.renderer.minGridDistance = 20;

    var series2 = chart.series.push(new am4charts.ColumnSeries());
    series2.dataFields.categoryX = "ageGroup";
    series2.dataFields.valueY = "females";
    series2.xAxis = categoryAxis2
  })
</script>